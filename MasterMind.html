<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Master Mind, le jeu</title>
  <style type="text/css">
	p.vert { color:Chartreuse }
	span.orange { color:Orange }
	<!-- span.name { color:#FF0000;font-weight:bold;font-family:Tahoma;font-size:20 } -->
  </style>
</head>
<body>

	<h1>Le super Master Mind de la mort</h1>
	<input type="button" onclick="return nouvelle_partie()" value="Nouvelle partie">
		
	<!-- affiche les précédentes propositions et leur résultat -->
	<p id="instructions"></p>
	
	<!-- affiche les précédentes propositions et leur résultat -->
	<p id="precedente_proposition"></p>
	
	<!-- affiche les lettres proposées par l'utilisateur -->
	<p id="proposition"></p>
	
	<!-- permet à l'utilisateur de proposer une lettre -->
	<input type="button" onclick="return proposer()" value="Proposer">

	<!-- affiche si c'est gagné ou perdu -->
	<p id="conclusion"></p>
	<p id="mot"></p>

	<script>
		//déclaration des accès aux éléments HTML
		
		//Variables
		//Nouvelle partie
		let nombreEssais, maximumEssais;
		let continuer, choixRecommencer;
		let precedentesPropositions;
		
		// Génération de la séquence
		let sequence, choix;
		let caractère_temporaire, nombre1, nombre2, nombre3, nombre4;
		let identique;
		
		// Lecture proposition du joueur 	
		let proposition;
		let redemander;
		let compteur1;
		
		//Affichage du résultat
		let lettresJustes;
		let lettresTrouves;
		let indication;
		let victoire;
		let choixContinuer;
	

		
		//TEMP : affecter un contenu
		document.getElementById("precedente_proposition").innerHTML = "Ici les précédentes propositions";
		document.getElementById("conclusion").innerHTML = "Proposez une séquence";
				
		//TEMP : lire un contenu
		let mot = document.getElementById("mot").innerHTML;
		console.log("Ce qu'il y a dans mot actuellement : " + mot);
		
		//TEMP : modifier un contenu
		document.getElementById("mot").innerHTML = "--E---";
		
		
		function nouvelle_partie() 
		{
			//let choix = confirm("Commencer une nouvelle partie ?");
			//if (choix)
			//{
				generationSequence();
				continuer = true;
				nombreEssais = 0;
				maximumEssais = 7;
				console.log("OK " + sequence);
				precedentesPropositions = "";
				
				document.getElementById("instructions").innerHTML = "Proposez quartre lettres différentes entre A et H. <br> Il vous reste " + (maximumEssais - nombreEssais) + " tentatives.";
				//l'utilisateur souhaite commencer une nouvelle partie
			//}
		}
		
		function generationSequence()
		{
			choix = "ABCDEFGH";
			sequence = "";
			caractère_temporaire = "";
			
			//Boucle pour faire les 4 lettres
			for(compteur1 = 0; compteur1 < 4; compteur1++){
				identique = false;
				//Recommencer si c'est déja dans la séquence
				do{
					caractère_temporaire = choix.charAt(Math.floor(Math.random() * choix.length));	
					for(compteur2 = 0; compteur2 < sequence.length; compteur2++){
					
						identique = (caractère_temporaire == sequence.charAt(compteur2));
						//Si c'est identique, regénérer, ne pas tester une autre lettre
						if(identique){
							break;
						}
					}
				}while(identique);
				sequence = sequence + caractère_temporaire;
			}
		}
		
		//gère une nouvelle proposition de l'utilisateur
		function proposer() 
		{
			proposition = "";
			redemander = false;
			
			//Lecture de la proposition jusqu'à ce qu'elle corresponde aux critères
			var propositionTemporaire = prompt("Quelle est votre proposition ?");
			
			
			console.log("Avant" + propositionTemporaire);
			proposition=propositionTemporaire.toUpperCase(); 
			console.log("Après" + proposition);
			
			//Test longueur et transformation en majucules
			if(proposition.length != 4){
				redemander = true;
				console.log(proposition.length + " != 4");
				alert("Il y a plus ou moins de 4 lettres.");
			}
			

			//Test longueur et doublons
			if(!redemander){
				for(compteur1 = 0; compteur1 < 4; compteur1++){
					
					//Annuler nouveau test de doublon
					if(redemander){
						break;
					}
					//Test si c'est entre A et H
					if(proposition.charAt(compteur1) < "A" || proposition.charAt(compteur1) > "H"){
						redemander = true;
						console.log(proposition.charAt(compteur1) + " bloque à première condition");
						alert("Tous les caractères ne sont pas compris entre A et H");
						break;
					}
					//Test de doublon
					for(compteur2 = 0; compteur2 < 4; compteur2++){
						if((compteur1 != compteur2) && (proposition.charAt(compteur1) == proposition.charAt(compteur2))){
							redemander = true;
							console.log(proposition.charAt(compteur1) + " bloque à deuxième condition");
							alert("Certaines lettres sont en double");
							break;
						}
					}

				}
			}
			if(redemander){
				console.log("Nouvelle demande");
				return proposer()
			}
			else{
				return analyseEtAffichage();
			}
		
			
			//------------ votre code doit figurer ci-dessous
			
			//TEMP : exemple d'instruction
			document.getElementById("proposition").innerHTML = proposition + " > " + "resultat";
			
			
			
			//------------ fin votre code avant ce commentaire
			return false;
		}
		
		//gère la création d'une nouvelle partie
		
		
		function nouvellePartie(){
		

			
			//Reset des réponses en cas de restart

	
			//Partie en cours
			while(continuer && nombreEssais < maximumEssais){
				lectureEtValidation();
				nombreEssais++;
				analyseEtAffichage();
			}
			
			//Fin du jeu
			if(nombreEssais == maximumEssais){
				alert("Vous avez dépassé le nombre d'essais ! La bonne réponse était " + sequence);
			}
			if(choixContinuer == "N"){
				alert("Vous avez abandonné ! La bonne réponse était " + sequence);
			}
			if(victoire){
				alert("Bravo ! Vous avez trouvé en " + nombreEssais + " essais.");
			}
			
			//Suite 
			choixRecommencer = prompt("Voulez-vous recommencer ? O/N");
			
			if(choixRecommencer == "O"){
				return nouvellePartie();
			}
		}

		
		function lectureEtValidation()
		{
			proposition = "";
			redemander = false;
			
			alert("Proposez quartre lettres différentes entre A et H.");
			alert("Il vous reste " + maximumEssais - nombreEssais + " tentatives.");
			
			
			//Lecture de la proposition jusqu'à ce qu'elle corresponde aux critères
			while(redemander){ 
				proposition = prompt("Quelle est votre proposition ?");
		
				//Test longueur et transformation en majucules
				if(proposition.length != 4){
					redemander = true;
					alert("Il y a plus ou moins de 4 lettres.");
				}
				
				if(!redemander){
					proposition.toUpperCase();
				}
				
				//Test longueur et doublons
				if(!redemander){
					for(compteur1 = 0; compteur1 < 4; compteur1++){
						//Test si c'est entre A et H
						if(proposition.charAt(compteur1) < A || proposition.charAt(compteur1) > H){
							redemander = true;
							alert("Tous les caractères ne sont pas compris entre A et H");
						}
						//Test de doublon
						for(compteur2 = 0; compteur2 < 4; compteur2++){
							if(compteur1 != compteur2){
								if(proposition.charAt(compteur1) == proposition.charAt(compteur2)){
									redemander = true;
									alert("Certaines lettres sont en double");
								}
							}
						}
					}
				}
			}
		}
		
		// Analyse de la proposition du joueur
		function analyseEtAffichage()
		{
			lettresJustes = 0;
			indication = "";
			lettresTrouves = 0;
		
			//Traitement des bonnes réponses
			for(compteur1 = 0; compteur1 < 4; compteur1++){
				if(proposition.charAt(compteur1) == sequence.charAt(compteur1)){
					lettresJustes++;
					lettresTrouves++;
					indication = indication + "&#128994;";
				}
			}
			
			//Traitement des bonnes réponses mal placées
			for(compteur1 = 0; compteur1 < 4; compteur1++){
				for(compteur2 = 0; compteur2 < 4; compteur2++){
					if(compteur1 != compteur2){
						if(proposition.charAt(compteur1) == sequence.charAt(compteur2)){
							lettresTrouves++;
							indication = indication + "&#128992;";
						}
					}
				}
			}
			
			//Replissage des vides
			for(compteur1 = lettresTrouves; compteur1 < 4; compteur1++){
				indication = indication + "&#9899;";
			}
	
			//Victoire
			if(lettresJustes == 4){
				continuer = false;
				victoire = true;
			}

			//Affichage des résultat
			else{
				document.getElementById("precedente_proposition").innerHTML = precedentesPropositions;
				
				document.getElementById("proposition").innerHTML = proposition + " -> " + indication;
				
				precedentesPropositions = precedentesPropositions + proposition + " -> " + indication + "<br>";

			}	
		}	
	
	
	</script>
</body>
</html>